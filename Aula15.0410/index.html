<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gerenciamento de Produtos</title>

    <style>
      table {
        width: 50%;
      }

      table,
      tr,
      td,
      th {
        border: 1px solid black;
        border-collapse: collapse;
      }

      .input {
        display: flex;
        max-width: 300px;
        flex-direction: column;
        margin-bottom: 8px;
      }
    </style>
  </head>
  <body>
    <h1>Gerenciamento de Produtos</h1>

    <form id="produtos-form">
      <div class="input">
        <label for="nome">Nome</label>
        <input type="text" id="nome" name="nome" />
      </div>
      <div class="input">
        <label for="categoria">Categoria</label>
        <select name="categoria" id="categoria">
          <option value="Eletrônico">Eletrônico</option>
          <option value="Roupas">Roupas</option>
          <option value="Limpeza">Limpeza</option>
          <option value="Higiene">Higiene</option>
          <option value="Frutas">Frutas</option>
          <option value="Vegetais">Vegetais</option>
        </select>
      </div>
      <div class="input">
        <label for="preco">Preço</label>
        <input type="number" id="preco" name="preco" step="0.01" />
      </div>

      <button type="submit">Cadastrar</button>
    </form>

    <hr />
    <h2>Produtos</h2>

    <table id="produtos-table">
      <thead>
        <tr>
          <th>Nome</th>
          <th>Categoria</th>
          <th>Preço</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <script>
      const API_URL = "http://localhost:8080";

      function criarLinhaProduto(produto) {
        const trProduto = document.createElement("tr");

        const tdNome = document.createElement("td");
        tdNome.textContent = produto.nome;
        trProduto.appendChild(tdNome);

        const tdCategoria = document.createElement("td");
        tdCategoria.textContent = produto.categoria;
        trProduto.appendChild(tdCategoria);

        const tdPreco = document.createElement("td");
        tdPreco.textContent = produto.preco.toLocaleString("pt-BR", {
          style: "currency",
          currency: "BRL",
        });
        trProduto.appendChild(tdPreco);

        return trProduto;
      }

      async function handleCarregarProdutos() {
        const response = await fetch(`${API_URL}/produtos`);
        const data = await response.json();

        const tableData = document.querySelector("#produtos-table tbody");

        for (let produto of data) {
          const trProduto = criarLinhaProduto(produto);
          tableData.appendChild(trProduto);
        }
      }

      window.addEventListener("load", handleCarregarProdutos);

      async function handleCadastrarProduto(event) {
        event.preventDefault();

        const form = event.target;

        const produto = {
          nome: form.nome.value,
          categoria: form.categoria.value,
          preco: Number(form.preco.value),
        };

        const response = await fetch(`${API_URL}/produtos`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(produto),
        });

        if (!response.ok) {
          alert("Error ao cadastrar produto.");
          return;
        }

        const tableData = document.querySelector("#produtos-table tbody");

        const trProduto = criarLinhaProduto(produto);
        tableData.appendChild(trProduto);

        form.reset();
      }

      const formProduto = document.getElementById("produtos-form");
      formProduto.addEventListener("submit", handleCadastrarProduto);
    </script>
  </body>
</html>